#!/bin/bash
set -e

PKGS=( \
    core \
    util-types \
    lsp \
)

# @cmd Build js
# @arg name[core|util-types|lsp|all]
build() {
    if [[ "$1" == "all" ]]; then
        for name in ${PKGS[@]}; do
            yarn --cwd js workspace @jsona/$name build
        done
    else
        yarn --cwd js workspace @jsona/$1 build
    fi
}

# @cmd Publish to npm
publish() {
    for name in ${PKGS[@]}; do
        online_ver=$(npm show @jsona/$name version)
        pkg_ver=$(node -p "require('./js/"$name"/package.json').version")
        if [[ "$online_ver" != "$pkg_ver" ]]; then
            read -p "Upgrade $name from $online_ver to $pkg_ver (y/n)? " choice
            if [[ "$choice" == y ]]; then
                (cd js/$name && npm publish)
            fi
        else
            echo @jsona/$name:$pkg_ver is up to date
        fi
    done
}


eval "$(argc --argc-eval $0 "$@")"
